#!/bin/bash

exec > .config

echo '# Generated by ./configure'

find_header() {
  descr=$1
  var=$2
  default=$3
  paths=$4
  file=$5

  echo -n "$descr... " 1>&2
  if test -e $default/$file; then
    echo "default location" 1>&2
    echo "$var="
    return
  fi;
  paths=`echo $paths | tr ':' ' '`
  for path in $paths; do
    if test -e $path/$file; then
      echo "$path/$file" 1>&2
      echo "$var=-I$path"
      return
    fi
  done
  echo "### Not found, please set $var in '.config'" 1>&2
  echo "$var=-I$default"
}

find_lib() {
  descr=$1
  varp=$2
  defp=$3
  paths=$4
  varl=$5
  defl=$6
  libs=$7

  echo -n "$descr... " 1>&2
  if test -e $defp/lib$defl.so || test -e $defp/lib$defl.a; then
    echo "default location" 1>&2
    echo "$varp="
    echo "$varl=-l$defl"
    return
  fi;
  paths=`echo $paths | tr ':' ' '`
  libs=`echo $libs | tr ':' ' '`
  for path in $defp $paths; do
    for lib in $defl $libs; do
      if test -e $path/lib$lib.so || test -e $path/lib$lib.a; then
        echo "$path/lib$lib" 1>&2
        echo "$varp=-L$path"
        echo "$varl=-l$lib"
        return
      fi
    done
  done
  echo "### Not found, please set $varp/$varl in '.config'" 1>&2
  echo "$varp=-L$defp"
  echo "$varl=-l$defl"
}

find_header "Tcl header" TCLINCLUDE /usr/include /usr/include/tcl:/usr/local/include:/usr/local/include/tcl:/usr/local/include/tcl8.3 tcl.h

find_lib "Tcl library"  TCLPATH /usr/lib /usr/X11R6/lib:/usr/local/lib:/usr/local/X11R6/lib TCLLIB tcl tcl8.3:tcl8.0:tcl4.2:tcl83

find_header "Tk header" TKINCLUDE /usr/include /usr/include/tk:/usr/local/include:/usr/local/include/tk:/usr/local/include/tk8.3 tk.h

find_lib "Tk library"  TKPATH /usr/lib /usr/X11R6/lib:/usr/local/lib:/usr/local/X11R6/lib TKLIB tk tk8.3:tk8.0:tk4.2:tk83

echo OS configuration stored in \".config\". 1>&2
